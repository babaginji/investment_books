<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>{{ shelf_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>{{ shelf_name }}</h1>

    <div class="books-container" id="books-container">
        <!-- JS が localStorage から本棚を描画 -->
    </div>

    <p><a href="{{ url_for('index') }}">トップに戻る</a></p>

    <script>
        const shelfName = "{{ shelf_name }}"; 
        const shelfBooksFromServer = {{ books|tojson }};
        
        // localStorage から「私の本棚」を取得
        function loadMyShelf() {
            return JSON.parse(localStorage.getItem("myShelf") || "[]");
        }
        function saveMyShelf(books) {
            localStorage.setItem("myShelf", JSON.stringify(books));
        }
        
        // 本棚描画
        function displayShelf() {
            const container = document.getElementById('books-container');
            container.innerHTML = '';
        
            let booksToShow = [];
        
            if (shelfName === "私の本棚") {
                // 「私の本棚」は localStorage の内容を表示
                booksToShow = loadMyShelf();
            } else {
                // 他の棚はサーバー棚の本だけ表示
                booksToShow = shelfBooksFromServer;
            }
        
            booksToShow.forEach(book => {
                const bookDiv = document.createElement('div');
                bookDiv.className = 'book';
        
                const star = document.createElement('span');
                star.className = 'star';
                star.textContent = '★';
                star.style.cursor = 'pointer';
                // 「私の本棚」だけ星を押せる
                if (shelfName === "私の本棚") {
                    star.style.color = 'gold';
                    star.onclick = () => {
                        let myShelf = loadMyShelf();
                        const index = myShelf.findIndex(b => b.title === book.title);
                        if (index === -1) {
                            myShelf.push(book);
                            star.style.color = 'gold';
                        } else {
                            myShelf.splice(index, 1);
                            star.style.color = 'gray';
                        }
                        saveMyShelf(myShelf);
                        displayShelf();
                    };
                }
        
                const imgLink = document.createElement('a');
                imgLink.href = book.itemUrl;
                imgLink.target = '_blank';
        
                const img = document.createElement('img');
                img.src = book.image;
                img.alt = book.title;
                imgLink.appendChild(img);
        
                const titleH3 = document.createElement('h3');
                titleH3.textContent = book.title;
        
                const authorP = document.createElement('p');
                authorP.textContent = '著者: ' + book.author;
        
                const priceP = document.createElement('p');
                priceP.textContent = '価格: ¥' + book.price;
        
                bookDiv.appendChild(star);
                bookDiv.appendChild(imgLink);
                bookDiv.appendChild(titleH3);
                bookDiv.appendChild(authorP);
                bookDiv.appendChild(priceP);
        
                container.appendChild(bookDiv);
            });
        }
        
        window.onload = displayShelf;
        </script>
        
</body>
</html>
