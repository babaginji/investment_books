<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>{{ shelf_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>{{ shelf_name }}</h1>

    <div class="books-container" id="books-container">
        {% for book in books %}
        <div class="book">
            <a href="{{ book.itemUrl }}" target="_blank">
                <img src="{{ book.image }}" alt="{{ book.title }}">
            </a>
            <h3>{{ book.title }}</h3>
            <p>著者: {{ book.author }}</p>
            <p>価格: ¥{{ book.price }}</p>
        </div>
        {% endfor %}
    </div>

    <p><a href="{{ url_for('index') }}">トップに戻る</a></p>

    <!-- ★判定用スクリプト -->
    <script>
        let myShelf = [];
        
        // localStorage から復元
        function loadMyShelf() {
            myShelf = JSON.parse(localStorage.getItem("myShelf") || "[]");
            displayStars();
        }
        
        // 本の★を表示
        function displayStars() {
            document.querySelectorAll('#books-container .book').forEach(bookDiv => {
                const title = bookDiv.querySelector('h3').textContent;
        
                const existingStar = bookDiv.querySelector('.star');
                if (existingStar) existingStar.remove();
        
                const star = document.createElement('span');
                star.className = 'star';
                star.textContent = myShelf.find(b => b.title === title) ? '★' : '☆';
                star.style.cursor = 'pointer';
        
                star.onclick = () => {
                    const author = bookDiv.querySelector('p').textContent.replace('著者: ', '');
                    const price = parseInt(bookDiv.querySelectorAll('p')[1].textContent.replace('価格: ¥', ''));
                    const image = bookDiv.querySelector('img').src;
                    const itemUrl = bookDiv.querySelector('a').href;
        
                    const index = myShelf.findIndex(b => b.title === title);
                    if (index === -1) {
                        // 追加
                        myShelf.push({ title, author, price, image, itemUrl });
                        star.textContent = '★';
                    } else {
                        // 削除
                        myShelf.splice(index, 1);
                        star.textContent = '☆';
                    }
        
                    // localStorage に保存
                    localStorage.setItem("myShelf", JSON.stringify(myShelf));
                };
        
                bookDiv.insertBefore(star, bookDiv.firstChild);
            });
        }
        
        window.onload = loadMyShelf;
        </script>
        
</body>
</html>
